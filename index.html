<html style="background-image:url(background.png);">
<head>
    <script type="text/javascript" src="scaledrone.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <style>
        video {
            box-shadow: rgba(156, 172, 172, 0.2) 0px 2px 2px, rgba(156, 172, 172, 0.2) 0px 4px 4px, rgba(156, 172, 172, 0.2) 0px 8px 8px, rgba(156, 172, 172, 0.2) 0px 16px 16px, rgba(156, 172, 172, 0.2) 0px 32px 32px, rgba(156, 172, 172, 0.2) 0px 64px 64px;
        }
        
        #tdVerify {
            height: 100%;
        }
        
        #tableVerify {
            height: 100%;
        }
        
        .btn-warning {
            color: #fff;
            background-color: #f0ad4e;
            border-color: #eea236
        }
        
        .btn {
            display: inline-block;
            padding: 6px 12px;
            margin-bottom: 0;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            -ms-touch-action: manipulation;
            touch-action: manipulation;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            background-image: none;
            border: 1px solid transparent;
            border-radius: 4px
        }
    </style>
</head>

<body id="body" style="position: absolute;top: 17px;left: -29px;margin: 0;align-items: center;justify-content: center;padding: 0 50px;font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
    <div style="margin: 0 auto;">
        <div>
            <p class="err" id="errorMessage" style="display: none;"></p>
            <textarea class="code" rows="29" cols="80" id="codeEditor" spellcheck="false" style="display: none;"></textarea>
            <video id="localVideo" autoplay="" muted="" style="visibility:hidden ;width:320; height:308;"></video>
            <video id="remoteVideo" autoplay="" muted="" width="300" height="300" style="position: absolute;left: 55px;top: 1px; width:950; height:395;"></video>
            <canvas id="canvasOutput" style="border:1px solid; display: none;"></canvas>
            <canvas id="canvasOutputLocal" width="320" height="308" style="border:1px solid; display: none;"></canvas>
            <canvas id="canvasIc" width="320" height="308" style="border:1px solid; display:none;"></canvas>
            <div id="divVerify" style="border: 4px solid;width: 315px;height: 388px;position: absolute;left: 1016px;top: 3px;">
               <div style="background-image:url(back.gif);height: 204px;">
                  <img id="img1" src="facial.gif" style="border:1px solid;width: 184px;height: 202px;">
                  <div style="background-image:url(trans.png);position: absolute;top: 16px;left: 203px;width: 100;height: 139px;">   
				</div>	                 
                     <label id="percent" style="position: absolute;top: 65px;left: 236px;"><font color="gold">%%</font></label>
                     <label id="verify" style="position: absolute;top: 119px;left: 209px;"><font color="gold">VERIFYING</font></label>
               </div>
               <button id="resendApiButton" style="visibility:hidden;position:absolute;left: 218px;top: 167px;" onclick="resendApi()">Try Again</button>
               <img id="img2" src="full-ic.png" style="width: 313px;height: 184px;">
            </div>
            <img id="bar" src="bar.png" style="height: 30px;width: 1310px;position: absolute;top: 402px;left:55px;">
            <div id="divChecking" style="width: 366px;height:142px;background: white;position: absolute;top: 443px;">
                <label style="font-weight: bold;position: absolute;left: 10px;top: 10px;">Verification:</label>
                <br>
                <br> <label style="position: absolute;left: 10px;top: 49px;"> 1. AML Check Result - </label><b><i><font color="green" style="position: absolute;left: 178px;top: 49px;">PASS</font></i></b>
                <img src="doc.png" style="width: 27px;height: 25px;position: absolute;top: 45px;left: 315px;">
                <br>
                <br> <label style="position: absolute;left: 10px;"> 2. Internal Blacklist - </label><b><i><font color="green" style="position: absolute;left: 160;">PASS</font></i></b>
                <img src="doc.png" style="width: 27px;height: 25px;position: absolute;top: 70px;left: 315;">
                <br>
                <br> <label style="position: absolute;left: 10px;top: 105px;"> 3. CTOS - </label><b><i><font color="green" style="position: absolute;left: 89px;top: 105px;">PASS</font></i></b>
                <img src="doc.png" style="width: 27px;height: 25px;position: absolute;top: 102px;left: 500;">
                <br>
            </div>
            <button id="approve" type="button" class="btn btn-warning" style="position: absolute;top: 461px;left: 1057px;width: 300;height: 50;background-color: #0b0860;">Approve</button>&nbsp;&nbsp;&nbsp;&nbsp;
            <button id="reject" type="button" class="btn btn-warning" style="position: absolute;top: 531px;left: 1057;height: 50;width:300;background-color: #0b0860;">Reject</button>
            <div id="kycInfo" style="position: absolute;top: 439px;left: 436px;">
                <label style="color: white;font-size: 14;font-weight: 100;">Bank Officer Complete KYC</label>
                <br>
                <div style="width: 408px;height: 124px;background: white;width: 600px;">
                    <label style="position: absolute;top: 24px;left: 10;font-weight: bold;">Remark:</label>
                </div>
            </div>
            <img id="imageIdCardData" src="face-ic.png" style="display: none;">
            <img id="imageBestData" src="full-ic.png" style="display: none;">
			<img id="imgUsed" src="face-ic.png" style="visibility: hidden;position: absolute;left: 1020px;top: 10px;width: 172px;height: 185px;">
			<button id="hangup" onclick="stopLocalStream();"  style="position:absolute;left:500;top:350;border-radius:50px;">
			<img src="hangup.png" style="width:40px"></button>
        </div>
    </div>
    <script src="script.js"></script>
    <script src="https://webrtc.github.io/adapter/adapter-5.0.4.js" type="text/javascript"></script>
    <script src="utils.js" type="text/javascript"></script>
    <script id="codeSnippet" type="text/code-snippet">
	let video = document.getElementById('remoteVideo');
         let src = new cv.Mat(video.height, video.width, cv.CV_8UC4);
         let dst = new cv.Mat(video.height, video.width, cv.CV_8UC4);
         let gray = new cv.Mat();
         let cap = new cv.VideoCapture(video);
         let faces = new cv.RectVector();
         let classifier = new cv.CascadeClassifier();
         console.log("classifier: " + classifier);
         
         // load pre-trained classifiers
         let check = classifier.load('\haarcascade_frontalface_default.xml');
         console.log("check:"+check);
         
         const FPS = 30;
         function processVideo() {
             try {
                 if (!streaming) {
                     console.log("if not streaming");
                     // clean and stop.
                     src.delete();
                     dst.delete();
                     gray.delete();
                     faces.delete();
                     classifier.delete();
                     return;
                 }
                 let begin = Date.now();
                 // start processing.
                 cap.read(src);
                 src.copyTo(dst);
                 cv.cvtColor(dst, gray, cv.COLOR_RGBA2GRAY, 0);
                 // detect faces.
                 classifier.detectMultiScale(gray, faces, 1.1, 3, 0);
                 // draw faces.
                 for (let i = 0; i < faces.size(); ++i) {
                     let face = faces.get(i);
                     let point1 = new cv.Point(face.x, face.y);
                     let point2 = new cv.Point(face.x + face.width, face.y + face.height);
                     cv.rectangle(dst, point1, point2, [255, 0, 0, 255]);
                 }
                 cv.imshow('canvasOutput', dst);
                 // schedule the next one.
                 let delay = 1000/FPS - (Date.now() - begin);
                 setTimeout(processVideo, delay);
             } catch (err) {
                 console.log(err);
                 utils.printError(err);
             }
         };
         
         // schedule the first one.
         setTimeout(processVideo, 0);
         </script>
            <script type="text/javascript">
                let utils = new Utils('errorMessage');

                utils.loadCode('codeSnippet', 'codeEditor');

                let streaming = false;
                let videoInput = document.getElementById('remoteVideo');
                let videoInput2 = document.getElementById('localVideo');
                let canvasOutput = document.getElementById('canvasOutput');
                let canvasContext = canvasOutput.getContext('2d');

                utils.startCamera('qvga', onVideoStarted, 'videoInput');

                function onVideoStarted() {
                    streaming = true;
                    videoInput2.setAttribute("style", "visibility: hidden;");
                    utils.executeCode('codeEditor');
                }

                utils.loadOpenCv(() => {
                    // streaming = true;
                    let faceCascadeFile = '\haarcascade_frontalface_default.xml';
                    utils.createFileFromUrl(faceCascadeFile, faceCascadeFile, () => {});
                });

                var video = document.getElementById('remoteVideo');
                var canvas = document.getElementById('canvasIc');
                var context = canvas.getContext('2d');
                var w, h, ratio;
                if (video.playing){
                    console.log("remote video playing");
                }else{
                    console.log("remote video not playing");
                }
                video.addEventListener('play', function() {
                    ratio = video.videoWidth / video.videoHeight;
                    w = video.videoWidth - 100;
                    h = parseInt(w / ratio, 10);
                    canvas.width = w;
                    canvas.height = h;
                    console.log("width: " + canvas.width + ",height: " + canvas.height);
                    var interval = setInterval(function() {
                        snap(interval);
                    }, 1000);

                }, false);
                //setTimeout(snap(),1000);

                function snap(interval) {
                    console.log("snap");
                    context.fillRect(0, 0, w, h);
                    // Grab the image from the video
                    context.drawImage(video, 0, 0, w, h);
                    console.log("done snap");
                    imageIdCardData.src = canvas.toDataURL("image/png");
                    imgUsed.src = canvas.toDataURL("image/png");
                    clearInterval(interval);
                }
                
            </script>
</body>
</html>